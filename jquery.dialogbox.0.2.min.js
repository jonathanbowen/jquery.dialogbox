(function($){var l={cancel:$.noop,cancelText:'Cancel',className:'',close:$.noop,confirm:$.noop,draggable:true,easing:'swing',focus:false,loadbar:false,maskOpacity:0.3,message:'',okText:'Ok',open:$.noop,position:'center',preventDefault:true,stopPropagation:true,promptText:'',promptType:'text',restore:true,title:'',transitions:'fast',type:'alert',shakes:true,width:270},Current={dragging:false,focussed:false,id:0,isIE6:$.browser.msie&&$.browser.version.substr(0,1)<7?true:false,left:0,msgHeight:0,onCancel:$.noop,options:{},outerHeight:0,restoreTo:{},srcEvent:false,top:0,triggered:false,width:0};$.fn.dialogbox=function(a,b){$(this)[b||'click'](function(e){Current.srcEvent=e;Current.triggered=true;$.fn.dialogbox.open(typeof a==='function'?a(e):a)});return this};$.fn.dialogbox.open=function(a){storeDimensions();if($('#dialogbox_outer').length){$.fn.dialogbox.close(Current.options.close,true)}a=typeof a==='object'?a:{message:a};typeof a.open==='function'&&a.open($.fn.dialogbox,Current.srcEvent);var b=a.position;a=$.extend({},l,a);a.position=b;var c=false;$('<div/>',{id:'dialogbox_mask','class':a.className,css:{height:$(document).height()+'px',opacity:a.maskOpacity}}).add($('<form/>',{action:'',onsubmit:'return false',id:'dialogbox_outer','class':'dialogbox_'+a.type+' '+a.className+($.browser.msie?' dialogbox_ie':''),html:'<div id="dialogbox_top_left"></div><div id="dialogbox_top_right"></div><div id="dialogbox_handle"><div id="dialogbox_handle_inner"></div></div><div id="dialogbox_inner"><div id="dialogbox_message"><div id="dialogbox_bottom_left"></div><div id="dialogbox_bottom_right"></div><div id="dialogbox_message_inner"></div><div id="dialogbox_buttons"></div></div></div>'})).appendTo($('body')).hide().fadeIn(Current.outerHeight?0:a.transitions,function(){if(!c){$('#dialogbox_outer').css('opacity',1);if(Current.isIE6){$('body').children('*[id!=dialogbox_outer]').find('select').css({display:'none'})}c=true}});var d=function(){$('#dialogbox_mask').css({height:$(document).height()+'px',width:Current.isIE6?$('body').outerWidth(true)+'px':'100%'})};d();$(window).resize(function(){d();$.fn.dialogbox.adjustPosition()});$.fn.dialogbox.set(a);if(Current.isIE6){$.fn.dialogbox.adjustPosition();$('#dialogbox_outer').click();$(window).scroll($.fn.dialogbox.adjustPosition).resize($.fn.dialogbox.adjustPosition)}if(Current.triggered&&Current.srcEvent){a.preventDefault&&Current.srcEvent.preventDefault();a.stopPropagation&&Current.srcEvent.stopPropagation()}Current.triggered=false;return this};$.fn.dialogbox.set=function(c,v){var e=$('#dialogbox_outer'),inner=$('#dialogbox_inner'),msgholder=$('#dialogbox_message'),msgdiv=$('#dialogbox_message_inner'),buttons=$('#dialogbox_buttons'),promptVal=$.fn.dialogbox.prompt();if(!e.length){return this}if($('#dialogbox_ok').length){storeDimensions();$('#dialogbox_loadbar').remove()}if(v!==undefined){var k=c;c={};c[k]=v}else if(typeof c!=='object'){c={message:c}}if(c.message!==undefined){var f=$.fn.dialogbox.form();if(typeof c.message==='string'){msgdiv.html(c.message)}else{c.message=c.message instanceof jQuery?c.message:$(c.message);restore();c.message.each(function(i){var a=$(this);Current.restoreTo[i]={parent:a.parent(),next:a.next(),previous:a.prev()}});msgdiv.append(c.message)}if(f.length){$.fn.dialogbox.form(f)}}if(c.title!==undefined){$('#dialogbox_handle_inner').text(c.title)}$.extend(Current.options,c);buttons.empty();$('<input id="dialogbox_ok" type="submit" value="'+Current.options.okText+'" />').appendTo(buttons);if(Current.options.type!=='alert'){$('<input id="dialogbox_cancel" type="button" value="'+Current.options.cancelText+'" />').appendTo(buttons)}$('#dialogbox_input').remove();if(Current.options.type==='prompt'){($('<input id="dialogbox_input" name="dialogbox_input" maxlength="30" type="'+(Current.options.promptType==='password'?'password':'text')+'" value="'+(c.promptText!==undefined?c.promptText:promptVal)+'" />')).appendTo(msgdiv)}e.css('width',Current.options.width+'px');$('#dialogbox_outer input[type=hidden]').hide();var g=msgdiv.css('height','auto').css('overflow','visible').height(),oldHeight=Current.msgHeight||g,ieAdjust=Current.isIE6?$(document).scrollTop():0,hDiff=g-oldHeight,wDiff=Current.width?Current.options.width-parseFloat(Current.width.replace('px','')):0;Current.width&&e.css('width',Current.width);if(!Current.outerHeight||c.position!==undefined){c.position=c.position===undefined?l.position:c.position;var h={},horizontals=['left','right'],verticals=['top','bottom'],strings=horizontals.concat(verticals),coords=typeof c.position==='object'?c.position:c.position.toString().replace(/^\s+|\s+$/,'').split(/\s+/);coords=$.extend(['center','center'],coords.slice(0,2));if($.inArray(coords[0],verticals)>-1||$.inArray(coords[1],horizontals)>-1){coords.reverse()}$.each(coords,function(k,a){var d=k?'top':'left';a=a.toString();if($.inArray(a,strings.slice(k*2,(k*2)+2))>-1){switch(a){case'top':case'left':h[d]=0;break;case'bottom':h[d]=$(window).height()-e.outerHeight();break;case'right':h[d]=$(document).width()-(Current.options.width)}}else if(!a.match(/^[\d\.-]+(px)?$/)){h[d]=(k?(ieAdjust+($(window).height()/2)-(e.outerHeight()/2)):(($(document).width()/2)-(Current.options.width/2)))}else{h[d]=a.replace(/[^\d\.-]+/g,'');var b=parseFloat(h[d].replace(/[^\d\.]+/g,''));h[d]=((h[d].substr(0,1)==='-'?((k?$(window).height()-e.outerHeight()+ieAdjust:($(document).width()-Current.options.width))-b):b+(k?ieAdjust:0)))}});h.top+='px';h.left=(parseFloat(h.left)>0?h.left:0)+'px';h.width=Current.options.width+'px';if(Current.outerHeight){e.css({top:Current.top,left:Current.left,width:Current.width}).animate(h,Current.options.transitions,Current.options.easing,$.fn.dialogbox.adjustPosition)}else{e.css(h);$.fn.dialogbox.adjustPosition()}}else{e.stop().css({top:Current.top,left:Current.left,width:Current.width}).animate({top:(hDiff>0?'-':'+')+'='+Math.abs(hDiff/2),width:Current.options.width+'px',left:(parseFloat(Current.left.replace('px',''))-(wDiff/2))+'px'},Current.options.transitions,Current.options.easing,$.fn.dialogbox.adjustPosition)}msgdiv.stop().css('overflow','hidden').css('height',oldHeight+'px').animate({height:(hDiff>0?'+':'-')+'='+Math.abs(hDiff)},Current.options.transitions,Current.options.easing,$.fn.dialogbox.focus);addEvents();if(Current.options.draggable){var j,abs;e.draggable({handle:'#dialogbox_handle',containment:$('body').height()>$(window).height()?'body':'window',start:function(){Current.dragging=true;j=e.css('top')},drag:function(){if(j!==false&&Math.abs(j-e.css('top'))>10){e.css('position','absolute');abs=true}j=false},stop:function(){Current.dragging=false;if(abs){e.css({position:'fixed',top:(parseFloat(e.css('top').replace('/px/',''))-$(document).scrollTop())+'px'})}$.fn.dialogbox.adjustPosition();storeDimensions()}})}if(Current.options.loadbar){$.fn.dialogbox.addLoadbar();Current.options.loadbar=false}return this};$.fn.dialogbox.close=function(a,b,c){if(!c||c===Current.id){setId();var d=$('#dialogbox_outer, #dialogbox_mask');d.stop().fadeOut(b?0:Current.options.transitions,function(){if(!$('#dialogbox_outer').length){return}restore();d.remove();if(Current.isIE6){$('select').css({display:''})}Current.focussed=false;typeof a==='function'&&a($.fn.dialogbox,Current.srcEvent)})}return this};$.fn.dialogbox.addLoadbar=function(){if(!$('#dialogbox_outer').length){$.fn.dialogbox.open()}if(!$('#dialogbox_loadbar').length){setId();var a=$('#dialogbox_buttons');$('#dialogbox_ok').focus();$('#dialogbox_buttons input').css('visibility','hidden');$('<div/>',{id:'dialogbox_loadbar',css:{height:a.outerHeight()+'px',width:a.outerWidth()+'px'}}).appendTo(a);if(Current.isIE6){$('#dialogbox_loadbar').css('display','block')}}return this};$.fn.dialogbox.removeLoadbar=function(){$('#dialogbox_buttons input').css('visibility','visible');$('#dialogbox_loadbar').remove();addEvents();return this};$.fn.dialogbox.prompt=function(a){var b;if(a!==undefined){$('#dialogbox_input').val(a);b=this}else{b=$('#dialogbox_input').val()}return b};$.fn.dialogbox.config=function(k,v){var c;if(v!==undefined){if(l[k]!==undefined){l[k]=v}c=this}else if(typeof k==='object'){$.each(k,function(a,b){$.fn.dialogbox.config(a,b)});c=this}else if(k!==undefined){c=l[k]}else{c=$.extend({},l)}return c};$.fn.dialogbox.form=function(n,v){var d;if(n===undefined){d=$('#dialogbox_outer').serializeArray()}else if(typeof n==='object'){$.each(n,function(a,b){var c=b.name!==undefined?[b.name,b.value]:[a,b];d=$.fn.dialogbox.form(c[0],c[1])})}else{var e=$('*[name='+n+']'),type=e.attr('type'),setting=v!==undefined;if(type==='radio'||type==='checkbox'){if(setting){v=$.map(typeof v==='object'?v:[v],function(a){return a+''})}e.each(function(){var a=$(this),val=a.val();if(setting){a.get(0).checked=$.inArray(val,v)>-1}else if(a.get(0).checked){d=d&&typeof d!=='object'?[d]:d;typeof d==='object'?d[d.length]=val:d=val}})}else{setting?e.val(v):d=e.val()}d=setting?this:d}return d};$.fn.dialogbox.reset=function(){var a=$('#dialogbox_outer');if(a.length){a.get(0).reset()}return this};$.fn.dialogbox.isOpen=function(){return $('#dialogbox_outer').length>0};$.fn.dialogbox.serialize=function(){return $('#dialogbox_outer').serialize()};$.fn.dialogbox.shake=function(a,i){a=typeof a==='number'?a:2;i=i||0;var b=$('#dialogbox_outer');if(i<a&&Current.options.shakes){if(!i){b.stop().css('margin-top',0)}b.animate({marginTop:'-=5'},50,Current.options.easing,function(){b.animate({marginTop:'+=5'},50,Current.options.easing,function(){$.fn.dialogbox.shake(a,++i)})})}else{b.animate({marginTop:0},50,Current.options.easing,$.fn.dialogbox.focus)}return this};$.fn.dialogbox.adjustPosition=function(){var a=$('#dialogbox_outer'),css={},offset=a.offset();if(!Current.dragging&&a.length){var b=offset.top-$(document).scrollTop(),left=offset.left;if(b<0){css.top=Current.isIE6?$(document).scrollTop():0}else{var c=a.outerHeight(),winHeight=$(window).height();if(b>0&&(offset.top+c)>($(document).scrollTop()+winHeight)){css.top=((Current.isIE6?$(document).scrollTop():0)+winHeight-c)+'px'}}if(left<0){css.left=0}else{var d=a.outerWidth(),winWidth=$(window).width();if(left>0&&((offset.left+d)>winWidth)){css.left=(winWidth-d)+'px'}}if(!$.isEmptyObject(css)){a.stop().animate(css,Current.options.transitions,Current.options.easing,function(){storeDimensions();$.fn.dialogbox.focus()})}}return this};$.fn.dialogbox.focus=function(){if($.browser.msie&&$.browser.version<8){$('<input/>').css('position','absolute').appendTo('#dialogbox_outer').focus().remove()}var a=$('#dialogbox_outer').find('input:visible, select:visible, textarea:visible, button:visible');if(a.length){Current.focussed=Current.focussed&&Current.focussed.is(':visible')?Current.focussed:(typeof Current.options.focus==='string'&&$(Current.options.focus).length&&$(Current.options.focus).parents('#dialogbox_inner').length?$(Current.options.focus):$(a[0]));Current.focussed.focus()}return this};$.fn.dialogbox.preload=function(){return $.fn.dialogbox.open().addLoadbar().close()};function setId(){Current.id=(new Date()).getTime()+''+Math.floor(Math.random()*1000000);return Current.id}function addEvents(){$('#dialobox_mask, #dialogbox_cancel').unbind();$('#dialogbox_outer').unbind('submit');$('#dialogbox_outer').unbind('keydown');var b=$('#dialogbox_outer'),id=setId(),fields=b.find('input:visible, select:visible, textarea:visible, button:visible'),func=function(a){if(!$('#dialogbox_loadbar').length){typeof Current.options[a]==='function'&&Current.options[a]($.fn.dialogbox,Current.srcEvent);$.fn.dialogbox.close(Current.options.close,false,id)}return false},confirm=function(){$('#dialogbox_ok').addClass('dialogbox_active');return func('confirm')},cancel=function(){$('#dialogbox_cancel').addClass('dialogbox_active');return func('cancel')};b.submit(confirm);fields.unbind('focus').unbind('blur').unbind('mouseover').unbind('mouseout').removeClass('dialogbox_focus').focus(function(){Current.focussed=$(this).addClass('dialogbox_focus')}).blur(function(){$(this).removeClass('dialogbox_focus')}).mouseover(function(){$(this).addClass('dialogbox_hover')}).mouseout(function(){$(this).removeClass('dialogbox_hover')});Current.onCancel=Current.options.type!=='alert'?cancel:confirm;$('#dialogbox_cancel').click(cancel);b.keydown(keydown);$(document).keydown($.fn.dialogbox.focus);$('#dialogbox_mask').mousedown($.fn.dialogbox.shake);$('body').children('*[id!=dialogbox_outer]').focusin($.fn.dialogbox.shake)}function restore(){if(Current.restoreTo.length&&Current.options.message instanceof jQuery){Current.options.message.each(function(i){var a=$(this),r=Current.restoreTo[i];$.each({next:'before',previous:'after',parent:'append'},function(k,v){if(r&&r[k]&&r[k].length){r[k][v](a);return false}})})}Current.restoreTo=[]}function keydown(a){var b=$('#dialogbox_ok'),cancel=$('#dialogbox_cancel'),entered=a.which,focussed=Current.focussed instanceof jQuery?Current.focussed.attr('id'):false;if(!b.length){return}if(entered===27){Current.onCancel();a.preventDefault()}else if(entered===39||entered===40){if(focussed==='dialogbox_ok'&&cancel.length){b.blur();cancel.focus()}if(focussed==='dialogbox_cancel'||focussed==='dialogbox_ok'){a.preventDefault()}}else if(entered===37||entered===38){if(focussed==='dialogbox_cancel'&&cancel.length){cancel.blur();b.focus()}if(focussed==='dialogbox_cancel'||focussed==='dialogbox_ok'){a.preventDefault()}}a.stopPropagation()}function storeDimensions(){var a=$('#dialogbox_outer');Current.msgHeight=$('#dialogbox_message_inner').height();Current.outerHeight=a.outerHeight();Current.width=a.css('width');Current.top=a.css('top');Current.left=a.css('left')}})(jQuery);